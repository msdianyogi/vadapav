<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./main.css">
    <title>Survey App</title>
</head>

<body onload="onLoadFunction">
    <div class="center">
        <h1>Vadapav Survey </h1>
        <div>
            <table class="table">
                <tr>
                    <td colspan="2"><img src="./vadapav.png" alt="Vada Pav"></td>
                </tr>
                <tr>
                    <td class="tdl"><label>Known</label></td>
                    <td><input type="button" id="knows" onclick="knowsCount()" value="Known" disabled></td>
                </tr>
                <tr>
                    <td><label>Not Known</label></td>
                    <td><input type="button" id="notknows" onclick="notKnowsCount()" value="Not Known" disabled></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="button" id="savedata" value="Save Data" disabled></td>
                </tr>
                <!-- <tr>
                    <td colspan="2"><input type="button" id="getdata" value="Get Data"></td>
                </tr> -->
                <tr>
                    <td><label>Known Count</label></td>
                    <td><label id="knownCount">loading...</label></td>
                </tr>
                <tr>
                    <td><label>Not Known Count</label></td>
                    <td><label id="notKnownCount">loading...</label></td>
                </tr>
                <tr>
                    <td><label>Total Count</label></td>
                    <td><label id="totalCount">loading...</label></td>
                </tr>
            </table>
        </div>
    </div>
</body>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyClnwGaRs9rok8Gc1BgQ7qdNnnfIkoYPsk",
        authDomain: "vadapav-survey.firebaseapp.com",
        databaseURL: "https://vadapav-survey-default-rtdb.firebaseio.com",
        projectId: "vadapav-survey",
        storageBucket: "vadapav-survey.appspot.com",
        messagingSenderId: "416588479903",
        appId: "1:416588479903:web:1592398272643ef86711aa"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    import { getDatabase, ref, get, set, child, update, remove }
        from "https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js";

    const db = getDatabase();
    function UpdateData() {
        set(ref(db, "Survey/"), {
            knownCount: document.getElementById("knownCount").innerHTML,
            notKnownCount: document.getElementById("notKnownCount").innerHTML
        })
            .then(() => {
                alert("Data Updated Successfully..!");
                window.location.reload();
            })
            .catch((error) => {
                alert("Error Occured ," + error);
            });
    }
    function GetData() {
        const dbref = ref(db);
        get(child(dbref, "Survey/")).then((snapshot) => {
            if (snapshot.exists()) {
                document.getElementById("knownCount").innerHTML = snapshot.val().knownCount;
                document.getElementById("notKnownCount").innerHTML = snapshot.val().notKnownCount;
                kcount = Number(snapshot.val().knownCount)
                kncount = Number(snapshot.val().notKnownCount);
                document.getElementById("totalCount").innerHTML = Number(snapshot.val().knownCount) + Number(snapshot.val().notKnownCount);
                document.getElementById("knows").removeAttribute("disabled");
                document.getElementById("notknows").removeAttribute("disabled");
                document.getElementById("savedata").removeAttribute("disabled");
            }
            else {
                alert("No Data Found");
            }
        }).catch((error) => {
            alert("Error Occured ," + error)
        })
    }
    savebutton.addEventListener("click", UpdateData);
    onLoadFunction = GetData();

</script>
<script>
    var savebutton = document.getElementById("savedata");
    var onLoadFunction;

    var kcount;
    var kncount;
    var totalcount;

    function knowsCount() {
        kcount += 1
        totalCount = kcount + kncount;

        document.getElementById("knownCount").innerHTML = kcount;
        document.getElementById("totalCount").innerHTML = totalCount;
    }
    function notKnowsCount() {
        kncount += 1
        totalCount = kcount + kncount;

        document.getElementById("notKnownCount").innerHTML = kncount;
        document.getElementById("totalCount").innerHTML = totalCount;
    }
</script>

</html>